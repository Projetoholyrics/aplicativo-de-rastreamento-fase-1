<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mapeador DDD ‚Äî Lista de Cidades</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 400px; width: 100%; margin-top: 10px; }
    .cities li { margin: 2px 0; }
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo-dot"></div>
        <h1>Mapeador DDD ‚Äî Cidades Associadas</h1>
      </div>
      <div class="note">Insira n√∫mero ou DDD ‚Äî mostra todas as cidades associadas ao DDD.</div>
    </header>

    <main class="main">
      <section class="left-panel">
        <div class="card">
          <h2>Entrada</h2>
          <p class="muted">Digite o n√∫mero (com ou sem +55) ou s√≥ o DDD (ex: 81).</p>
          <input id="phoneInput" class="input" placeholder="+55 (11) 99999-0000 ou 11" />
          <div class="actions">
  <button id="btnMap" class="btn primary">Mapear DDD</button>
  <button onclick="iniciarRastreamentoReal()" class="btn primary">
    üì± Rastrear meu celular
  </button>
  <button id="btnClear" class="btn ghost">Limpar</button>
</div>

        <div class="card history">
          <h3>Hist√≥rico</h3>
          <ul id="historyList" class="case-list"></ul>
        </div>
      </section>

      <section class="right-panel">
        <div class="card tracker">
          <div class="tracker-header">
            <h2 id="statusTitle">Pronto</h2>
            <div id="statusSub" class="muted">Insira um n√∫mero e clique em "Mapear DDD".</div>
          </div>

          <div class="visual">
            <div id="radar" class="radar"><div class="line"></div></div>
          </div>

          <div id="map"></div> <!-- MAPA INTERATIVO -->

          <div id="result" class="result">
            <div class="placeholder muted">Aguardando entrada...</div>
            <div id="cityList" class="city-list"></div>
          </div>

          <div class="tracker-footer">
            <div class="small muted">Dados: lista oficial de cidades por DDD.</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer muted">Prot√≥tipo local ‚Äî lista de cidades representativas por DDD.</footer>
  </div>

<script>
/* ---------- DADOS: DDD -> cidade principal + lista de cidades ---------- */
const dddData = {
  "11": { main:"S√£o Paulo","state":"SP", coords:[-23.55,-46.63], cities:["S√£o Paulo","Guarulhos","Osasco","Santo Andr√©","S√£o Bernardo do Campo","S√£o Caetano do Sul","Mau√°","Diadema","Suzano","Barueri"] },
  "12": { main:"S√£o Jos√© dos Campos","state":"SP", coords:[-23.19,-45.89], cities:["S√£o Jos√© dos Campos","Taubat√©","Jacare√≠","Aparecida","Ca√ßapava","Pindamonhangaba"] },
  "13": { main:"Santos","state":"SP", coords:[-23.96,-46.33], cities:["Santos","S√£o Vicente","Praia Grande","Guaruj√°","Cubat√£o"] },
  "14": { main:"Bauru","state":"SP", coords:[-22.33,-49.06], cities:["Bauru","Mar√≠lia","Botucatu","Len√ß√≥is Paulista","Arealva"] },
  "15": { main:"Sorocaba","state":"SP", coords:[-23.50,-47.46], cities:["Sorocaba","Itapetininga","Tatu√≠","Votorantim","Ara√ßoiaba da Serra"] },
  "16": { main:"Ribeir√£o Preto","state":"SP", coords:[-21.18,-47.81], cities:["Ribeir√£o Preto","Araraquara","Franca","S√£o Carlos","Mat√£o"] },
  "17": { main:"S√£o Jos√© do Rio Preto","state":"SP", coords:[-20.82,-49.38], cities:["S√£o Jos√© do Rio Preto","Votuporanga","Catanduva","Fernand√≥polis"] },
  "18": { main:"Presidente Prudente","state":"SP", coords:[-22.12,-51.41], cities:["Presidente Prudente","Ara√ßatuba","Assis","Dracena"] },
  "19": { main:"Campinas","state":"SP", coords:[-22.90,-47.06], cities:["Campinas","Piracicaba","Indaiatuba","Valinhos","Paul√≠nia"] },
  "21": { main:"Rio de Janeiro","state":"RJ", coords:[-22.90,-43.20], cities:["Rio de Janeiro","Niter√≥i","Duque de Caxias","Nova Igua√ßu","S√£o Gon√ßalo"] },
  "22": { main:"Campos dos Goytacazes","state":"RJ", coords:[-21.76,-41.33], cities:["Campos dos Goytacazes","Maca√©","Cabo Frio","Mendes","S√£o Fid√©lis"] },
  "24": { main:"Volta Redonda","state":"RJ", coords:[-22.52,-44.10], cities:["Volta Redonda","Resende","Barra Mansa","Pinheiral","Quatis"] },
  "27": { main:"Vit√≥ria","state":"ES", coords:[-20.32,-40.34], cities:["Vit√≥ria","Vila Velha","Serra","Cariacica","Guarapari"] },
  "28": { main:"Cachoeiro de Itapemirim","state":"ES", coords:[-20.85,-41.12], cities:["Cachoeiro de Itapemirim","Guarapari","Marata√≠zes","Venda Nova do Imigrante"] },
  "31": { main:"Belo Horizonte","state":"MG", coords:[-19.92,-43.94], cities:["Belo Horizonte","Contagem","Betim","Uberl√¢ndia","Juiz de Fora","Montes Claros"] },
  "32": { main:"Juiz de Fora","state":"MG", coords:[-21.76,-43.34], cities:["Juiz de Fora","Petr√≥polis (RJ) - √°rea metropolitana"] },
  "33": { main:"Governador Valadares","state":"MG", coords:[-18.85,-41.95], cities:["Governador Valadares","Manhua√ßu"] },
  "34": { main:"Uberl√¢ndia","state":"MG", coords:[-18.91,-48.28], cities:["Uberl√¢ndia","Araguari"] },
  "35": { main:"Po√ßos de Caldas","state":"MG", coords:[-21.78,-46.56], cities:["Po√ßos de Caldas","Pouso Alegre"] },
  "37": { main:"Uberaba","state":"MG", coords:[-19.75,-47.95], cities:["Uberaba","Franca (SP) - √°rea"] },
  "38": { main:"Montes Claros","state":"MG", coords:[-16.73,-43.86], cities:["Montes Claros","Janu√°ria"] },
  "41": { main:"Curitiba","state":"PR", coords:[-25.43,-49.27], cities:["Curitiba","Londrina","Maring√°","Ponta Grossa"] },
  "42": { main:"Ponta Grossa","state":"PR", coords:[-25.10,-50.16], cities:["Ponta Grossa","Castro"] },
  "43": { main:"Londrina","state":"PR", coords:[-23.30,-51.16], cities:["Londrina","Rol√¢ndia"] },
  "44": { main:"Maring√°","state":"PR", coords:[-23.42,-51.93], cities:["Maring√°","Cianorte"] },
  "45": { main:"Foz do Igua√ßu","state":"PR", coords:[-25.55,-54.58], cities:["Foz do Igua√ßu","Cascavel"] },
  "46": { main:"Pato Branco","state":"PR", coords:[-26.22,-52.67], cities:["Pato Branco","Francisco Beltr√£o"] },
  "47": { main:"Joinville","state":"SC", coords:[-26.30,-48.84], cities:["Joinville","Blumenau","Jaragu√° do Sul"] },
  "48": { main:"Florian√≥polis","state":"SC", coords:[-27.60,-48.55], cities:["Florian√≥polis","S√£o Jos√©","Palho√ßa"] },
  "49": { main:"Chapec√≥","state":"SC", coords:[-27.10,-52.61], cities:["Chapec√≥","Conc√≥rdia"] },
  "51": { main:"Porto Alegre","state":"RS", coords:[-30.03,-51.23], cities:["Porto Alegre","Canoas","Novo Hamburgo"] },
  "53": { main:"Pelotas","state":"RS", coords:[-31.76,-52.34], cities:["Pelotas","Rio Grande"] },
  "54": { main:"Caxias do Sul","state":"RS", coords:[-29.16,-51.18], cities:["Caxias do Sul","Bento Gon√ßalves"] },
  "55": { main:"Santa Maria","state":"RS", coords:[-29.69,-53.81], cities:["Santa Maria","Santa Cruz do Sul"] },
  "61": { main:"Bras√≠lia","state":"DF", coords:[-15.79,-47.88], cities:["Bras√≠lia","Gama","Taguatinga"] },
  "62": { main:"Goi√¢nia","state":"GO", coords:[-16.68,-49.25], cities:["Goi√¢nia","An√°polis"] },
  "63": { main:"Palmas","state":"TO", coords:[-10.18,-48.33], cities:["Palmas","Aragua√≠na"] },
  "64": { main:"Rio Verde","state":"GO", coords:[-17.79,-50.92], cities:["Rio Verde","Catal√£o"] },
  "65": { main:"Cuiab√°","state":"MT", coords:[-15.59,-56.10], cities:["Cuiab√°","Rondon√≥polis"] },
  "66": { main:"Rondon√≥polis","state":"MT", coords:[-16.47,-54.64], cities:["Rondon√≥polis","Sinop"] },
  "67": { main:"Campo Grande","state":"MS", coords:[-20.47,-54.62], cities:["Campo Grande","Dourados"] },
  "68": { main:"Rio Branco","state":"AC", coords:[-9.97,-67.81], cities:["Rio Branco","Cruzeiro do Sul"] },
  "69": { main:"Porto Velho","state":"RO", coords:[-8.76,-63.90], cities:["Porto Velho","Ji-Paran√°"] },
  "71": { main:"Salvador","state":"BA", coords:[-12.97,-38.50], cities:["Salvador","Feira de Santana","Vit√≥ria da Conquista"] },
  "72": { main:"Eun√°polis","state":"BA", coords:[-16.37,-39.07], cities:["Eun√°polis","Porto Seguro"] },
  "73": { main:"Ilh√©us","state":"BA", coords:[-14.79,-39.05], cities:["Ilh√©us","Itabuna"] },
  "74": { main:"Juazeiro","state":"BA", coords:[-9.41,-40.51], cities:["Juazeiro","Jacobina"] },
  "75": { main:"Feira de Santana","state":"BA", coords:[-12.25,-38.96], cities:["Feira de Santana","Serrinha"] },
  "77": { main:"Vit√≥ria da Conquista","state":"BA", coords:[-14.86,-40.83], cities:["Vit√≥ria da Conquista","Guanambi"] },
  "79": { main:"Aracaju","state":"SE", coords:[-10.91,-37.07], cities:["Aracaju","Nossa Senhora do Socorro"] },
  "81": { main:"Recife","state":"PE", coords:[-8.05,-34.90], cities:["Recife","Olinda","Jaboat√£o dos Guararapes","Paulista"] },
  "82": { main:"Macei√≥","state":"AL", coords:[-9.66,-35.73], cities:["Macei√≥","Arapiraca"] },
  "83": { main:"Jo√£o Pessoa","state":"PB", coords:[-7.12,-34.86], cities:["Jo√£o Pessoa","Campina Grande"] },
  "84": { main:"Natal","state":"RN", coords:[-5.79,-35.21], cities:["Natal","Mossor√≥"] },
  "85": { main:"Fortaleza","state":"CE", coords:[-3.72,-38.54], cities:["Fortaleza","Juazeiro do Norte","Sobral"] },
  "86": { main:"Teresina","state":"PI", coords:[-5.09,-42.80], cities:["Teresina","Parna√≠ba"] },
  "87": { main:"Petrolina","state":"PE", coords:[-9.39,-40.50], cities:["Petrolina","Salgueiro"] },
  "88": { main:"Juazeiro do Norte","state":"CE", coords:[-7.21,-39.32], cities:["Juazeiro do Norte","Crato"] },
  "89": { main:"Parna√≠ba","state":"PI", coords:[-2.90,-41.77], cities:["Parna√≠ba","Picos"] },
  "91": { main:"Bel√©m","state":"PA", coords:[-1.46,-48.50], cities:["Bel√©m","Ananindeua","Santar√©m"] },
  "92": { main:"Manaus","state":"AM", coords:[-3.10,-60.02], cities:["Manaus","Coari"] },
  "93": { main:"Santar√©m","state":"PA", coords:[-2.43,-54.70], cities:["Santar√©m","Itaituba"] },
  "94": { main:"Marab√°","state":"PA", coords:[-5.38,-49.13], cities:["Marab√°","Parauapebas"] },
  "95": { main:"Boa Vista","state":"RR", coords:[2.82,-60.67], cities:["Boa Vista","Caracara√≠"] },
  "96": { main:"Macap√°","state":"AP", coords:[0.03,-51.06], cities:["Macap√°","Mazag√£o"] },
  "97": { main:"Coari","state":"AM", coords:[-4.08,-63.13], cities:["Coari","Humait√°"] },
  "98": { main:"S√£o Lu√≠s","state":"MA", coords:[-2.53,-44.30], cities:["S√£o Lu√≠s","Imperatriz"] },
  "99": { main:"Imperatriz","state":"MA", coords:[-5.53,-47.48], cities:["Imperatriz","Caxias"] }
};

/* ---------- UTIL & UI ---------- */
const phoneInput = document.getElementById('phoneInput');
const btnMap = document.getElementById('btnMap');
const btnClear = document.getElementById('btnClear');
const statusTitle = document.getElementById('statusTitle');
const statusSub = document.getElementById('statusSub');
const cityListEl = document.getElementById('cityList');
const historyList = document.getElementById('historyList');

function extractDDD(input){
  if(!input) return null;
  const digits = input.replace(/\D/g,'');
  if(digits.startsWith('55') && digits.length>=4) return digits.substr(2,2);
  if(digits.length >= 10) return digits.substr(0,2);
  if(digits.length === 2) return digits;
  return null;
}

/* ---------- MAPA LEAFLET ---------- */
const map = L.map('map').setView([-14.24, -51.92], 4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap contributors'
}).addTo(map);
let marker;

/* ---------- EVENTOS ---------- */
btnMap.addEventListener('click', () => {
  const raw = phoneInput.value.trim();
  if(!raw){ alert('Insira um n√∫mero ou DDD.'); return; }
  const ddd = extractDDD(raw);
  const info = dddData[ddd];
  if(!info){ alert('DDD n√£o encontrado'); return; }

  // Atualiza lista de cidades
  cityListEl.innerHTML = '<ul class="cities">' + info.cities.map(c => `<li>${c}</li>`).join('') + '</ul>';

  // Atualiza marcador no mapa
  const [lat, lon] = info.coords;
  if(marker) map.removeLayer(marker);
  marker = L.marker([lat, lon]).addTo(map)
    .bindPopup(`<b>${info.main}</b><br>${info.state}`).openPopup();
  map.setView([lat, lon], 7);

  // Atualiza status
  statusTitle.textContent = `${info.main} ‚Äî ${info.state}`;
  statusSub.textContent = `Cidades associadas ao DDD ${ddd}`;

  // Hist√≥rico
  const li = document.createElement('li');
  li.textContent = `DDD ${ddd} ‚Äî ${info.main} (${info.state})`;
  historyList.prepend(li);
});

btnClear.addEventListener('click', () => {
  phoneInput.value = '';
  statusTitle.textContent = 'Pronto';
  statusSub.textContent = 'Insira um n√∫mero e clique em "Mapear DDD".';
  cityListEl.innerHTML = '<div class="placeholder muted">Aguardando entrada...</div>';
  if(marker) map.removeLayer(marker);
});
</script>
</body>
</html>
function iniciarRastreamentoReal() {
  if (!navigator.geolocation) {
    alert("Geolocaliza√ß√£o n√£o suportada");
    return;
  }

  navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lon]).addTo(map)
        .bindPopup("Localiza√ß√£o atual do celular")
        .openPopup();

      map.setView([lat, lon], 15);
    },
    (err) => {
      alert("Erro ao obter localiza√ß√£o");
    },
    { enableHighAccuracy: true }
  );
}
let watchId = null;

// ---------- RASTREAMENTO REAL DO CELULAR (GPS) ----------
function iniciarRastreamentoReal() {
  if (!navigator.geolocation) {
    alert("Geolocaliza√ß√£o n√£o suportada neste dispositivo");
    return;
  }

  statusTitle.textContent = "Rastreando celular (GPS)";
  statusSub.textContent = "Localiza√ß√£o em tempo real ativa";

  watchId = navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const acc = pos.coords.accuracy;

      if (marker) map.removeLayer(marker);

      marker = L.marker([lat, lon]).addTo(map)
        .bindPopup(`üìç Voc√™ est√° aqui<br>Precis√£o: ${Math.round(acc)}m`)
        .openPopup();

      map.setView([lat, lon], 17);
    },
    (err) => {
      alert("Erro ao obter localiza√ß√£o: " + err.message);
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}
